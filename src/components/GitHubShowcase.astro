---
import data from "../data/github.json";

const repos = data.repos;

// Derive language frequency
const langCounts = {};
repos.forEach(r => {
  if(r.primaryLanguage){
    langCounts[r.primaryLanguage] = (langCounts[r.primaryLanguage] || 0) + 1;
  }
});
const topLangs = Object.entries(langCounts)
  .sort((a,b)=>b[1]-a[1])
  .slice(0,5);
---
<section aria-labelledby="gh-heading" class="gh-section">
  <h2 id="gh-heading">GitHub Activity & Repositories</h2>
  <p class="updated">Data snapshot: {new Date(data.updated).toLocaleDateString()}</p>

  <div class="lang-badges">
    {topLangs.map(([lang,count]) => (
      <span class="lang">{lang} <small>{count}</small></span>
    ))}
  </div>

  <div class="repo-grid">
    {repos.map(r => (
      <article class="repo-card">
        <h3><a href={r.url} target="_blank" rel="noopener">{r.name}</a></h3>
        <p class="desc">{r.description}</p>
        <p class="meta">
          {r.primaryLanguage && <span class="pill">{r.primaryLanguage}</span>}
          <span class="pill">★ {r.stars}</span>
          {typeof r.forks === 'number' && <span class="pill">⑂ {r.forks}</span>}
        </p>
        <p class="pushed">Updated: {new Date(r.pushedAt).toLocaleDateString()}</p>
      </article>
    ))}
  </div>
{data.contributions?.length > 0 && (
  <div class="contrib">
    <h3>Open Source Contributions</h3>
    <ul>
      {data.contributions.map(c => (
        <li>
          <a href={c.url} target="_blank" rel="noopener">{c.repo} PR #{c.pr}</a> – {c.title}
          {c.impact && <em class="impact"> ({c.impact})</em>}
        </li>
      ))}
    </ul>
  </div>
)}
<style>
.contrib h3 { margin:2.2rem 0 .6rem; font-size:1.05rem; }
.contrib ul { padding-left:1.1rem; line-height:1.35; font-size:.78rem; }
.impact { opacity:.65; }
</style>
</section>

<style>
.gh-section { margin-top:3.5rem; }
.updated { font-size:.7rem; opacity:.55; letter-spacing:.7px; text-transform:uppercase; }
.lang-badges { display:flex; flex-wrap:wrap; gap:.5rem; margin:.8rem 0 1.4rem; }
.lang { background:#141b23; padding:.45rem .7rem; border:1px solid #27303b; border-radius:24px; font-size:.7rem; letter-spacing:.5px; display:inline-flex; gap:.4rem; align-items:center;}
.repo-grid { display:grid; gap:1rem; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); }
.repo-card { background:#10141a; border:1px solid #2a2f35; padding:1rem; border-radius:14px; display:flex; flex-direction:column; gap:.45rem; }
.repo-card h3 { margin:0; font-size:1rem; }
.repo-card h3 a { text-decoration:none; color:#e6e6e6; }
.repo-card h3 a:hover { color:#4f46e5; }
.desc { font-size:.78rem; line-height:1.3; opacity:.85; margin:0; }
.meta { display:flex; flex-wrap:wrap; gap:.4rem; margin:.2rem 0 0; font-size:.65rem; }
.pill { background:#1b2430; padding:.25rem .45rem; border-radius:6px; border:1px solid #2a2f35; }
.pushed { margin:0; font-size:.6rem; opacity:.5; }
</style>

